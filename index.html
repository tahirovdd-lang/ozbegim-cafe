<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>O'ZBEGIM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  /* ‚úÖ –ë–ê–ó–ê (—Ç–≤–æ–∏) */
  --bg:#F8F3E9;
  --terracotta:#C76B2F;
  --gold:#D4A017;
  --green:#1F4D3A;
  --meat:#8B1E1E;

  --stroke: rgba(199,107,47,.35);
  --stroke-strong: rgba(199,107,47,.50);
  --inner: rgba(255,255,255,.70);
  --shadow: rgba(120,70,20,.10);
  --shadow-strong: rgba(120,70,20,.18);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;

  /* ‚úÖ –ù–û–í–û–ï: ‚Äú—Å–∞–º–∞—Ä–∫–∞–Ω–¥—Å–∫–∏–π —Å–∏–Ω–∏–π‚Äù + –ø–∞–ª–∏—Ç—Ä–∞ */
  --samarkand-blue:#1f4aa8;
  --atlas-red:#8b1e1e;
  --sand:#f8f3e9;
  --text:#2b2b2b;

  /* ‚úÖ –ù–û–í–û–ï: –∞—Ç–ª–∞—Å-–ø–∞—Ç—Ç–µ—Ä–Ω (–±–µ–∑ —Ñ–∞–π–ª–æ–≤) */
  --atlas-pattern: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260' viewBox='0 0 260 260'%3E%3Cpath d='M10 80 C60 20 120 20 170 80 S250 140 210 190 120 240 70 200 0 140 10 80Z' fill='%238b1e1e' fill-opacity='0.20'/%3E%3Cpath d='M30 120 C70 70 120 70 160 120 S220 170 190 210 120 240 80 215 10 170 30 120Z' fill='%231f4aa8' fill-opacity='0.16'/%3E%3Ccircle cx='210' cy='55' r='16' fill='%23d4a017' fill-opacity='0.18'/%3E%3Ccircle cx='60' cy='205' r='14' fill='%23d4a017' fill-opacity='0.14'/%3E%3C/svg%3E");
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background: linear-gradient(180deg, #fff, var(--bg));
  color:var(--text);
  padding-bottom:88px;
}

/* ‚úÖ‚úÖ‚úÖ SPLASH (–°–∞–º–∞—Ä–∫–∞–Ω–¥/–∫—Ä–µ–ø–æ—Å—Ç–∏) ‚Äî –∞–∫—Ü–µ–Ω—Ç, –Ω–µ –º–µ—à–∞–µ—Ç –º–µ–Ω—é */
.splash{
  position:fixed;
  inset:0;
  z-index:2000;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding:22px 16px;
  color:#fff;
  background:
    linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)),
    url("samarkand.jpg") center/cover no-repeat;
}
.splash .panel{
  width:min(520px, 100%);
  border-radius:26px;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding:16px;
  position:relative;
  overflow:hidden;
}
.splash .panel::before{
  content:"";
  position:absolute;
  inset:0;
  background: var(--atlas-pattern);
  opacity:.08;
  pointer-events:none;
}
.splash .title{
  font-family:'Lobster',cursive;
  font-size:34px;
  margin:0 0 6px;
}
.splash .subtitle{
  margin:0 0 10px;
  font-weight:800;
  opacity:.92;
}
.splash .note{
  font-size:12px;
  font-weight:700;
  opacity:.80;
}
.splash .btn{
  width:100%;
  margin-top:12px;
  padding:12px 14px;
  border-radius:16px;
  border:0;
  font-family:'Montserrat',sans-serif;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,var(--gold), #ffd77a);
}

/* ‚úÖ –®–ê–ü–ö–ê */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--terracotta),var(--gold));
  color:white;
  box-shadow:0 6px 18px rgba(120,70,20,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
  overflow:hidden; /* ‚úÖ –≤–∞–∂–Ω–æ */
}

/* ‚úÖ‚úÖ‚úÖ –£–°–ò–õ–ï–ù–ù–´–ô –ê–¢–õ–ê–° –í –®–ê–ü–ö–ï (—Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å) */
.header::before{
  content:"";
  position:absolute;
  left:0; right:0; top:0;
  height:14px;                 /* –≤—ã—à–µ –ø–æ–ª–æ—Å–∫–∞ */
  background: var(--atlas-pattern);
  opacity:.28;                 /* –∑–∞–º–µ—Ç–Ω–æ */
  mix-blend-mode: soft-light;  /* ‚Äú—Ç–∫–∞–Ω–µ–≤—ã–π‚Äù —ç—Ñ—Ñ–µ–∫—Ç */
  pointer-events:none;
  z-index:2;
}
.header::after{
  content:"";
  position:absolute;
  inset:0;
  background: var(--atlas-pattern);
  opacity:.18;                 /* –∑–∞–º–µ—Ç–Ω–æ, –Ω–æ –Ω–µ —Ç—è–∂–µ–ª–æ */
  mix-blend-mode: soft-light;
  pointer-events:none;
  z-index:1;
}

.header img{position:absolute;left:12px;width:110px; z-index:5;}

.brand-title{
  font-family:'Lobster',cursive;
  font-size:36px;
  position:relative;
  z-index:6;
}
.brand-sub{
  font-weight:800;
  font-size:15px;
  position:relative;
  z-index:6;
}
.brand-phone{position:relative; z-index:50; pointer-events:auto;}
.brand-phone a{
  color:white;
  text-decoration:none;
  font-size:15px;
  font-weight:700;
  position:relative;
  z-index:51;
  pointer-events:auto;
  cursor:pointer;
}

.search-btn{
  position:absolute;
  right:14px;
  bottom:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  z-index:60;

  color:#333;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-btn:active{transform:scale(.97);}

.langs,.types,.payments{
  display:flex;
  gap:12px;
  padding:12px;
  justify-content:center;
}

.btn{
  padding:12px 20px;
  border-radius:var(--r-pill);
  font-weight:700;
  min-width:120px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
}
.btn:active{transform:scale(.98);}
.btn.active{
  background:linear-gradient(135deg,var(--terracotta),var(--gold));
  color:white;
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.45), 0 8px 18px var(--shadow-strong);
}

.input{
  margin:8px auto;
  display:block;
  padding:14px;
  width:85%;
  border-radius:var(--r-md);
  font-size:15px;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;
  transition:.15s;
}
.input:focus{
  border-color: var(--stroke-strong);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);
}

.categories{
  display:flex;
  gap:12px;
  padding:14px;
  overflow-x:auto;
  scroll-behavior:smooth;
}

/* ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏) */
.section-divider{
  height:18px;
  margin:14px 12px 10px;
  border-radius:999px;
  background: var(--atlas-pattern);
  opacity:.09;
  border:1px solid rgba(0,0,0,.04);
}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:12px;
}

/* ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∏: ‚Äú–∫–µ—Ä–∞–º–∏–∫–∞‚Äù + –º—è–≥–∫–∏–π hover */
.card{
  border-radius:var(--r-lg);
  padding:12px;
  text-align:center;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
  transition:.15s;
  position:relative;
  overflow:hidden;
}
.card::after{
  content:"";
  position:absolute;
  right:-30px;
  top:-30px;
  width:120px;
  height:120px;
  background: var(--atlas-pattern);
  opacity:.06;
  transform: rotate(10deg);
  pointer-events:none;
}
.card:active{transform:scale(.99);}

.img{height:76px;display:flex;align-items:center;justify-content:center;}
.img img{max-width:62px;opacity:.9;}

.price{font-weight:800;color:var(--meat);margin-top:6px;}
.price small{font-weight:700;opacity:.75;margin-left:4px;}

.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(255,255,255,.6);
  background:var(--green);
  color:white;
  font-size:16px;
  box-shadow:0 6px 14px var(--shadow);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

.cart{
  background:#fffdf9;
  margin:12px;
  padding:16px;
  border-radius:var(--r-lg);
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
}

textarea.input{height:90px;}

.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:var(--r-lg);
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:800;

  border:1px solid rgba(255,255,255,.55);
  background:linear-gradient(135deg,var(--green),#2e7d32);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.22), 0 10px 22px rgba(31,77,58,.18);
  transition:.15s;
}
.order-btn:active{transform:scale(.99);}

.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s; z-index:1500;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;
  padding:26px;
  border-radius:var(--r-lg);
  text-align:center;
  font-weight:700;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
  position:relative;
  overflow:hidden;
}
.popup-box::before{
  content:"";
  position:absolute;
  inset:0;
  background: var(--atlas-pattern);
  opacity:.08;
  pointer-events:none;
}

.search-wrap{
  width:85%;
  margin:8px auto;
  position:relative;
  display:none;
  z-index:70;
}
.search-wrap.show{display:block;}
.search-wrap input{width:100%;margin:0;padding-right:44px;}
.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-clear:active{transform:translateY(-50%) scale(.96);}

.search-title{
  width:85%;
  margin:10px auto 0;
  font-weight:800;
  opacity:.9;
  display:none;
  z-index:70;
  position:relative;
}
.search-title.show{display:block;}

mark{background:rgba(212,160,23,.25);padding:0 .12em;border-radius:6px;}

.quick-filters{
  display:flex;
  gap:10px;
  padding:0 12px 10px;
  overflow-x:auto;
}
.qbtn{
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  border-radius:999px;
  padding:10px 14px;
  font-weight:800;
  cursor:pointer;
  white-space:nowrap;
  transition:.15s;
}
.qbtn:active{transform:scale(.98);}

.popular-wrap{width:100%;padding:4px 12px 6px;}
.popular-title{width:100%;font-weight:900;padding:8px 2px 10px;display:flex;align-items:center;gap:8px;}
.popular-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;}
.pop-card{
  min-width:150px;
  border-radius:var(--r-lg);
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
  cursor:pointer;
  transition:.15s;
  position:relative;
  overflow:hidden;
}
.pop-card::after{
  content:"";
  position:absolute;
  right:-34px; top:-34px;
  width:120px; height:120px;
  background: var(--atlas-pattern);
  opacity:.06;
  pointer-events:none;
  transform: rotate(8deg);
}
.pop-card:active{transform:scale(.99);}
.pop-img{
  height:74px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(199,107,47,.08);
}
.pop-img img{width:100%;height:100%;object-fit:cover;}
.pop-name{font-weight:900;margin-top:8px;}
.pop-price{font-weight:900;color:var(--meat);margin-top:4px;}
.pop-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}

.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background:rgba(248,243,233,.88);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(199,107,47,.25);
}
.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:18px;
  padding:10px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(120,70,20,.12);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}
.sticky-btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.55);
  background:linear-gradient(135deg,var(--green),#2e7d32);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.20), 0 10px 22px rgba(31,77,58,.18);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{transform:scale(.99);}

@media (hover:hover){
  .btn:hover{box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);}
  .card:hover{transform:translateY(-2px); box-shadow: inset 0 0 0 2px var(--inner), 0 12px 26px rgba(120,70,20,.16);}
  .qbtn:hover{box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);}
  .search-btn:hover{box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);}
  .sticky-btn:hover{box-shadow: inset 0 0 0 2px rgba(255,255,255,.22), 0 14px 28px rgba(31,77,58,.22);}
  .pop-card:hover{transform:translateY(-2px);}
}
</style>
</head>

<body>

<div class="splash" id="splash">
  <div class="panel">
    <p class="title">O'ZBEGIM</p>
    <p class="subtitle">–ú–∏–ª–ª–∏–π —Ç–∞–æ–º–ª–∞—Ä ‚Ä¢ Signature taste</p>
    <p class="note">–°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Äî —Å–µ—Ä–¥—Ü–µ –í–µ–ª–∏–∫–æ–≥–æ –®—ë–ª–∫–æ–≤–æ–≥–æ –ø—É—Ç–∏</p>
    <button class="btn" style="min-width:unset; border:none;" onclick="closeSplash()">
      üçΩ –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é
    </button>
  </div>
</div>

<div class="header">
  <img src="logo.png" onerror="this.src='logo.png'">
  <div style="position:relative; z-index:6;">
    <div class="brand-title">O'ZBEGIM</div>
    <div class="brand-sub">Signature taste</div>
    <div class="brand-phone">
      <a href="tel:+998905389999" onclick="callPhone(event)">+998 90 538 99 99</a>
    </div>
  </div>
  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥–∞..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="quick-filters" id="quickFilters"></div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="sendOrder()" id="stickyOrder">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* ‚úÖ Splash: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é */
function closeSplash(){
  const el = document.getElementById('splash');
  if(el) el.style.display = 'none';
  try{ sessionStorage.setItem('ozbegim_splash','1'); }catch(_){}
}
(function initSplash(){
  try{
    if(sessionStorage.getItem('ozbegim_splash') === '1'){
      const el = document.getElementById('splash');
      if(el) el.style.display = 'none';
    }
  }catch(_){}
})();

/* ‚úÖ –∑–≤–æ–Ω–æ–∫ –∏–∑ WebApp */
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905389999";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(tel);
      return;
    }
  }catch(_){}
  try{ window.location.href = tel; }catch(_){}
}

const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

let lang='ru',category='salads',type='delivery',payment='cash',cart={};

const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop'},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular'}
};

const CATS={
  ru:{salads:'ü•ó –°–∞–ª–∞—Ç—ã',sauce:'ü•£ –°–æ—É—Å',first:'üçú –ü–µ—Ä–≤—ã–µ –±–ª—é–¥–∞',hot:'üç≤ –ì–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞',garnish:'üçü –ì–∞—Ä–Ω–∏—Ä',drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏'},
  uz:{salads:'ü•ó Salatlar',sauce:'ü•£ Souslar',first:'üçú Birinchi taomlar',hot:'üç≤ Issiq taomlar',garnish:'üçü Garnir',drinks:'ü•§ Ichimliklar'},
  en:{salads:'ü•ó Salads',sauce:'ü•£ Sauces',first:'üçú First dishes',hot:'üç≤ Hot dishes',garnish:'üçü Side dishes',drinks:'ü•§ Drinks'}
};

/* ‚úÖ –ú–ï–ù–Æ */
const MENU = {
  salads:[
    ['–í–µ—Å–µ–Ω–Ω–∏–π',25000,'logo.png'],
    ['–û—Å–µ–Ω–Ω–∏–π',30000,'logo.png'],
    ['–ì—Ä–µ—á–µ—Å–∫–∏–π',40000,'logo.png'],
    ['–í–µ—á–æ',45000,'logo.png'],
    ['–ö—Ä–∞–±–æ–≤—ã–π',40000,'logo.png'],
    ['–≠–ª–∏—Ç–Ω—ã–π',45000,'logo.png'],
    ['–°–º–∞–∫',40000,'logo.png'],
    ['–°–∞–ª–∞—Ç —Å —Ä—É–∫–æ–ª–ª–æ–π',45000,'logo.png'],
    ['–í–∏–Ω–µ–≥—Ä–µ—Ç',40000,'logo.png'],
    ['–¶–µ–∑–∞—Ä—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π',45000,'logo.png'],
    ['–û–ª–∏–≤—å–µ',40000,'logo.png'],
    ['–°–≤–µ–∂–∏–π',25000,'logo.png']
  ],
  sauce:[
    ['–ß–∞–ª–æ–ø',10000,'logo.png'],
    ['–°–æ—É—Å –∏–∑ –ø–æ–º–∏–¥–æ—Ä–æ–≤',5000,'logo.png']
  ],
  first:[
    ['–®—É—Ä–ø–∞',40000,'logo.png'],
    ['–ü–µ–ª—å–º–µ–Ω–∏',40000,'logo.png'],
    ['–õ–∞–≥–º–∞–Ω',40000,'logo.png'],
    ['–°—É–ø –±—É–ª—å–æ–Ω',20000,'logo.png']
  ],
  hot:[
    ['–ú–∞–Ω—Ç—ã 1—à—Ç',10000,'logo.png'],
    ['–ü–ª–æ–≤ 0.5',50000,'logo.png'],
    ['–•–∞–ª–∏—Å–∞',80000,'logo.png'],
    ['–ö—É—Ä—É—Ç–æ–±',80000,'logo.png'],
    ['–ñ–∞—Ä–µ–Ω–Ω—ã–π –õ–∞–≥–º–∞–Ω',50000,'logo.png']
  ],
  garnish:[
    ['–§—Ä–∏',20000,'logo.png']
  ],
  drinks:[
    ['Coca Cola 1.5L',20000,'logo.png'],
    ['Fanta 1.5L',20000,'logo.png'],
    ['Pepsi 1.5L',20000,'logo.png'],
    ['–°–æ–∫ –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ 1L',20000,'logo.png'],
    ['–í–æ–¥–∞ –≥–∞–∑\\–±–µ–∑ –≥–∞–∑–∞ Chertoq 1.5L',8000,'logo.png'],
    ['–ß–∞–π –ó–µ–ª–µ–Ω—ã–π\\ –ß–µ—Ä–Ω—ã–π',5000,'logo.png'],
    ['–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º',15000,'logo.png'],
    ['–ö–æ—Ñ–µ —Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π —á–µ—Ä–Ω—ã–π',10000,'logo.png']
  ]
};

/* ‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ */
const POPULAR = [
  ['–ü–ª–æ–≤ 0.5',50000,'logo.png'],
  ['–ú–∞–Ω—Ç—ã 1—à—Ç',10000,'logo.png'],
  ['–®—É—Ä–ø–∞',40000,'logo.png'],
  ['–¶–µ–∑–∞—Ä—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π',45000,'logo.png']
];

function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(name, q){
  const n = escapeHtml(name);
  if(!q) return n;
  const idx = n.toLowerCase().indexOf(q.toLowerCase());
  if(idx === -1) return n;
  const before = n.slice(0, idx);
  const mid = n.slice(idx, idx + q.length);
  const after = n.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

/* ‚úÖ localStorage keys –±–µ–∑ –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∞ */
function loadSaved(){
  const a = localStorage.getItem("ozbegim_address") || '';
  const p = localStorage.getItem("ozbegim_phone") || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem("ozbegim_address", address.value));
  phone.addEventListener('input', ()=>localStorage.setItem("ozbegim_phone", phone.value));
}

function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}

function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  stickyOrder.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  popularTitle.innerText = TEXT[lang].popular;

  renderPopular();
  renderQuickFilters();
  renderCats();
  renderProducts();
  updateTotal();
}

function renderPopular(){
  popularRow.innerHTML = '';
  POPULAR.forEach(([n,p,img])=>{
    cart[n]=cart[n]||0;
    popularRow.innerHTML += `
      <div class="pop-card" onclick="addPopular('${n}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${img}" onerror="this.src='logo.png'"></div>
        <div class="pop-name">${escapeHtml(n)}</div>
        <div class="pop-price">${formatSum(p)} <small>—Å—É–º</small></div>
      </div>
    `;
  });
}
function addPopular(n){
  chg(n, 1);
  if(isSearchOpen()) closeSearch();
}

function renderQuickFilters(){
  const keys = ['salads','hot','first','drinks'];
  quickFilters.innerHTML = '';
  keys.forEach(k=>{
    if(!MENU[k]) return;
    quickFilters.innerHTML += `<button class="qbtn" onclick="pickCategory('${k}')">${CATS[lang][k]}</button>`;
  });
}
function pickCategory(k){
  if(isSearchOpen()) closeSearch();
  category = k;
  renderCats();
  renderProducts();
}

function renderCats(){
  cats.innerHTML='';
  for(let k in MENU){
    cats.innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';renderCats();renderProducts()">${CATS[lang][k] || k}</button>`;
  }
  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 50);
}

function cardHTML(n,p,img,q=''){
  const nameHtml = highlight(n, q);
  return `<div class="card">
    <div class="img"><img src="${img}" onerror="this.src='logo.png'"></div>
    <div>${nameHtml}</div>
    <div class="price">${formatSum(p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${n}',-1)">‚àí</button>
      <span id="c_${n}">${cart[n]||0}</span>
      <button onclick="chg('${n}',1)">+</button>
    </div>
  </div>`;
}

function renderProducts(){
  products.innerHTML='';
  MENU[category].forEach(([n,p,img])=>{
    cart[n]=cart[n]||0;
    products.innerHTML+=cardHTML(n,p,img,'');
  });
}

function chg(n,v){
  cart[n]=Math.max(0,(cart[n]||0)+v);
  const el = document.getElementById('c_'+n);
  if(el) el.innerText=cart[n];
  updateTotal();
}

function price(n){
  for(let c in MENU) for(let i of MENU[c]) if(i[0]==n) return i[1];
  return 0;
}

function updateTotal(){
  let s=0;
  for(let k in cart) s += (cart[k]||0) * price(k);
  total.innerText = formatSum(s);
  stickyTotal.innerText = formatSum(s);
}

function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

/* ‚úÖ –ü–æ–∏—Å–∫ */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }

function toggleSearch(){
  if(isSearchOpen()) closeSearch();
  else openSearch();
}
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  quickFilters.style.display = 'none';
  popularWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  quickFilters.style.display = '';
  popularWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){
  closeSearch();
}

function onSearchKey(e){
  if(e.key === 'Enter'){
    closeSearch();
  }
}

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';

  if(!q){
    MENU[category].forEach(([n,p,img])=>{
      cart[n]=cart[n]||0;
      products.innerHTML += cardHTML(n,p,img,'');
    });
    return;
  }

  for(let c in MENU){
    MENU[c].forEach(([n,p,img])=>{
      if(String(n).toLowerCase().includes(q)){
        cart[n]=cart[n]||0;
        products.innerHTML += cardHTML(n,p,img,q);
      }
    });
  }
}

/* ‚úÖ –∞–≤—Ç–æ-–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –Ω–µ–≥–æ */
document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn){
    closeSearch();
  }
}, true);

/* ‚úÖ‚úÖ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç ‚Ññ2: –Ω–æ–º–µ—Ä OZB-DDMM-001 (—Å—á—ë—Ç—á–∏–∫ –≤ localStorage –Ω–∞ —ç—Ç–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ) */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `ozbegim_seq_${d.getFullYear()}${mm}${dd}`;

  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));

  const num = String(n).padStart(3,'0');
  return `OZB-${dd}${mm}-${num}`;
}

function calcTotalNum(){
  let s = 0;
  for (const k in cart) s += (Number(cart[k] || 0) * price(k));
  return s;
}

/* ‚úÖ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (qty > 0) */
function sendOrder(){
  popup.classList.add('show');

  const cleanOrder = {};
  for (const k in cart) {
    const q = Number(cart[k] || 0);
    if (q > 0) cleanOrder[k] = q;
  }

  if (Object.keys(cleanOrder).length === 0) {
    popup.classList.remove('show');
    alert(lang === 'ru' ? '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è' : (lang === 'uz' ? 'Savat bo‚Äòsh' : 'Cart is empty'));
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    order: cleanOrder,
    total: total.innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: address.value,
    phone: phone.value,
    comment: comment.value,
    order_id: genOrderId()
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

loadSaved();
bindSave();
applyLang();
</script>
</body>
</html>
