<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>O'ZBEGIM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Yeseva+One&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --sand:#fbf7ef;
  --text:#1f1f1f;

  --gold:#D4A017;
  --samarkand:#1f4aa8;
  --green:#1F4D3A;
  --atlas-red:#8B1E1E;

  --card-bg: rgba(255,255,255,.84);
  --line: rgba(0,0,0,.07);
  --shadow: 0 14px 34px rgba(0,0,0,.10);

  --r-lg:26px;
  --r-md:20px;
  --r-sm:16px;
}

/* ‚úÖ –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê (—á–µ—Ä–µ–∑ data-theme="dark") */
body[data-theme="dark"]{
  --sand:#121212;
  --text:#f1f1f1;

  --card-bg: rgba(28,28,28,.90);
  --line: rgba(255,255,255,.12);
  --shadow: 0 18px 44px rgba(0,0,0,.35);
}

*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:
    radial-gradient(1200px 600px at 50% -120px, rgba(31,74,168,.14), transparent 60%),
    linear-gradient(180deg, #fff, var(--sand));
  color:var(--text);
  padding-bottom:88px;
}

/* ===== HEADER ===== */
.header{
  padding:18px 14px 30px;
  color:#fff;
  position:relative;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;

  background:
    linear-gradient(180deg, rgba(0,0,0,.56), rgba(0,0,0,.34)),
    url("atlas.jpg") center/cover no-repeat;

  box-shadow: 0 16px 34px rgba(0,0,0,.18);
  border-bottom: 1px solid rgba(255,255,255,.16);
}
.header::after{
  content:"";
  position:absolute;
  inset:0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  pointer-events:none;
}
.header::before{
  content:"";
  position:absolute;
  left:0; right:0; bottom:0;
  height:16px;
  background: linear-gradient(90deg, rgba(212,160,23,0), rgba(212,160,23,.42), rgba(212,160,23,0));
  opacity:.75;
  pointer-events:none;
}

.header img{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  width:128px;
  max-width:42vw;
  height:auto;
  z-index:5;
  filter: drop-shadow(0 12px 22px rgba(0,0,0,.28));
}

/* ‚úÖ O'ZBEGIM ‚Äî —Å–¥–≤–∏–Ω—É–ª–∏ –ø—Ä–∞–≤–µ–µ */
.brand-title{
  font-family:'Yeseva One', serif;
  font-size:40px;
  letter-spacing:1px;
  text-transform:uppercase;
  text-shadow: 0 12px 22px rgba(0,0,0,.28);
  position:relative;
  z-index:6;
  line-height:1.0;
  transform: translateX(32px);
}
.brand-sub{ display:none; }

.brand-phone{ position:relative; z-index:50; pointer-events:auto; margin-top:8px; }
.brand-phone a{
  color:#fff;
  text-decoration:none;
  font-size:15px;
  font-weight:900;
  position:relative;
  z-index:51;
  opacity:.95;
}

/* Search */
.search-btn{
  position:absolute;
  right:14px;
  bottom:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:900;
  cursor:pointer;
  z-index:60;

  color:#fff;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.search-btn:active{ transform:scale(.97); }

/* ‚úÖ‚úÖ‚úÖ BURGER BUTTON (—Å–ø—Ä–∞–≤–∞ –≤ —à–∞–ø–∫–µ) */
.burger-btn{
  position:absolute;
  right:62px;
  bottom:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:65;

  color:#fff;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition:.15s;
}
.burger-btn:active{ transform:scale(.97); }

.burger-ic{ width:18px; height:12px; position:relative; }
.burger-ic span{
  position:absolute; left:0; right:0;
  height:2px; border-radius:8px;
  background:#fff; opacity:.95;
}
.burger-ic span:nth-child(1){ top:0; }
.burger-ic span:nth-child(2){ top:5px; }
.burger-ic span:nth-child(3){ bottom:0; }

/* ===== Buttons ===== */
.langs,.types,.payments{
  display:flex;
  gap:10px;
  padding:12px 12px 6px;
  justify-content:center;
}

.btn{
  padding:12px 16px;
  border-radius:18px;
  font-weight:900;
  min-width:118px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--line);
  background: rgba(255,255,255,.86);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  color:var(--text);
}
.btn:active{ transform:scale(.98); }
.btn.active{
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:#fff;
  border:1px solid rgba(255,255,255,.20);
  box-shadow: 0 14px 30px rgba(31,74,168,.18);
}

/* ‚úÖ –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —à–∏—Ä–µ */
.categories .btn{
  min-width:160px;
  padding:12px 22px;
}

/* ===== Inputs ===== */
.input{
  margin:8px auto;
  display:block;
  padding:14px 14px;
  width:88%;
  border-radius:18px;
  font-size:15px;

  border:1px solid var(--line);
  background: rgba(255,255,255,.90);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  outline:none;
  transition:.15s;
  color:var(--text);
}
body[data-theme="dark"] .input{ background: rgba(28,28,28,.90); }

.input:focus{
  border-color: rgba(31,74,168,.35);
  box-shadow: 0 14px 30px rgba(31,74,168,.12);
}

.categories{
  display:flex;
  gap:10px;
  padding:12px 12px 4px;
  overflow-x:auto;
  scroll-behavior:smooth;
}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
  padding:12px;
}

/* ===== Cards ===== */
.card{
  border-radius:24px;
  padding:12px 10px;
  text-align:center;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition:.15s;
}
body[data-theme="dark"] .card{ border-color: rgba(255,255,255,.10); }
.card:active{ transform:scale(.99); }

.img{ height:78px; display:flex; align-items:center; justify-content:center; }
.img img{ max-width:66px; opacity:.95; }

.price{ font-weight:900; color:var(--atlas-red); margin-top:6px; }
.price small{ font-weight:800; opacity:.75; margin-left:4px; }

.counter{ display:flex; justify-content:center; gap:10px; margin-top:8px; align-items:center; }
.counter button{
  width:34px;
  height:34px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(255,255,255,.22);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:white;
  font-size:16px;
  box-shadow: 0 12px 22px rgba(31,74,168,.18);
  transition:.15s;
}
.counter button:active{ transform:scale(.96); }

/* ===== Cart ===== */
.cart{
  background: rgba(255,255,255,.86);
  margin:12px;
  padding:16px;
  border-radius:26px;
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body[data-theme="dark"] .cart{ background: rgba(28,28,28,.90); border-color: rgba(255,255,255,.10); }

textarea.input{ height:90px; }

.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:24px;
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;

  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  box-shadow: 0 18px 36px rgba(31,74,168,.18);
  transition:.15s;
}
.order-btn:active{ transform:scale(.99); }

/* ===== Popup ===== */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:1500;
}
.popup.show{ opacity:1; pointer-events:auto; }
.popup-box{
  background: rgba(255,255,255,.92);
  padding:26px;
  border-radius:26px;
  text-align:center;
  font-weight:900;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 20px 60px rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body[data-theme="dark"] .popup-box{ background: rgba(28,28,28,.92); border-color: rgba(255,255,255,.10); }

/* ===== Search ===== */
.search-wrap{
  width:88%;
  margin:8px auto;
  position:relative;
  display:none;
  z-index:70;
}
.search-wrap.show{ display:block; }
.search-wrap input{ width:100%; margin:0; padding-right:44px; }

.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 22px rgba(0,0,0,.08);
  transition:.15s;
  color:#111;
}
body[data-theme="dark"] .search-clear{ background: rgba(28,28,28,.92); border-color: rgba(255,255,255,.10); color:#f1f1f1; }

.search-clear:active{ transform:translateY(-50%) scale(.96); }

.search-title{
  width:88%;
  margin:10px auto 0;
  font-weight:900;
  opacity:.92;
  display:none;
  z-index:70;
  position:relative;
}
.search-title.show{ display:block; }

mark{ background:rgba(212,160,23,.28); padding:0 .14em; border-radius:8px; }

/* ===== Popular ===== */
.popular-wrap{ width:100%; padding:4px 12px 4px; }
.popular-title{
  width:100%;
  font-weight:900;
  padding:8px 2px 10px;
  display:flex;
  align-items:center;
  gap:8px;
}
.popular-row{ display:flex; gap:12px; overflow-x:auto; padding:2px 2px 10px; }
.pop-card{
  min-width:150px;
  border-radius:24px;
  padding:10px;
  background: var(--card-bg);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: var(--shadow);
  cursor:pointer;
  transition:.15s;
  position:relative;
  overflow:hidden;
}
body[data-theme="dark"] .pop-card{ border-color: rgba(255,255,255,.10); }
.pop-card:active{ transform:scale(.99); }
.pop-img{
  height:74px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(31,74,168,.10);
}
.pop-img img{ width:100%; height:100%; object-fit:cover; }
.pop-name{ font-weight:900; margin-top:8px; }
.pop-price{ font-weight:900; color:var(--atlas-red); margin-top:4px; }
.pop-badge{ position:absolute; left:10px; top:10px; font-size:18px; pointer-events:none; }

/* ===== Sticky checkout ===== */
.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background: rgba(251,247,239,.72);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
}
body[data-theme="dark"] .sticky-checkout{ background: rgba(18,18,18,.72); border-top-color: rgba(255,255,255,.10); }

.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:20px;
  padding:10px 12px;
  background: rgba(255,255,255,.88);
  border:1px solid rgba(0,0,0,.06);
  box-shadow: 0 16px 34px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{ background: rgba(28,28,28,.88); border-color: rgba(255,255,255,.10); }

.sticky-sum{ font-weight:900; line-height:1.1; }
.sticky-sum small{ display:block; font-weight:800; opacity:.70; margin-top:2px; }
.sticky-btn{
  padding:12px 14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: 0 16px 34px rgba(31,74,168,.16);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{ transform:scale(.99); }

/* ===== BURGER MENU MODAL ===== */
.menu-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.40);
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:2000;
}
.menu-backdrop.show{ opacity:1; pointer-events:auto; }

.menu-sheet{
  position:fixed;
  left:0; right:0;
  bottom:-120%;
  z-index:2010;
  transition:.22s;
  padding:10px 12px 14px;

  background: rgba(255,255,255,.92);
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 48px rgba(0,0,0,.22);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .menu-sheet{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.10);
}
.menu-sheet.show{ bottom:0; }

.menu-handle{
  width:44px;
  height:5px;
  border-radius:999px;
  background:rgba(0,0,0,.18);
  margin:6px auto 10px;
}
body[data-theme="dark"] .menu-handle{ background:rgba(255,255,255,.18); }

.menu-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:2px 4px 10px;
}
.menu-head b{ font-size:16px; }
.menu-close{
  width:38px;height:38px;
  border:none;
  border-radius:12px;
  background:transparent;
  cursor:pointer;
  font-size:22px;
  line-height:1;
  color:#777;
}
body[data-theme="dark"] .menu-close{ color:#bbb; }

.menu-list{ display:flex; flex-direction:column; gap:8px; }

.menu-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
  cursor:pointer;
  text-decoration:none;
  color:var(--text);
}
body[data-theme="dark"] .menu-item{
  border-color: rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}

.menu-left{ display:flex; align-items:center; gap:10px; min-width:0; }
.menu-ic{
  width:32px; height:32px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,.06);
  flex:0 0 auto;
}
body[data-theme="dark"] .menu-ic{ background: rgba(255,255,255,.06); }
.menu-txt{ display:flex; flex-direction:column; min-width:0; }
.menu-name{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-sub{ font-size:12px; opacity:.75; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.menu-right{ opacity:.65; font-weight:900; }

.review-wrap{ display:none; padding:6px 4px 10px; }
.review-card{
  border:1px solid rgba(0,0,0,.08);
  border-radius:18px;
  overflow:hidden;
  background:#fff;
  padding:10px;
  display:flex;
  justify-content:center;
}
body[data-theme="dark"] .review-card{ background:#0f0f0f; border-color: rgba(255,255,255,.10); }

.about-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  z-index:2100;
  padding:18px 14px;
}
.about-modal.show{ display:block; }

.about-card{
  max-width:760px;
  margin:0 auto;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(0,0,0,.08);
  border-radius:24px;
  box-shadow: 0 18px 54px rgba(0,0,0,.22);
  padding:14px 14px 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body[data-theme="dark"] .about-card{
  background: rgba(28,28,28,.92);
  border-color: rgba(255,255,255,.10);
}

.about-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px; }
.about-head b{ font-size:16px; }
.about-body{ font-size:14px; line-height:1.45; white-space:pre-wrap; }

.about-tabs{
  display:flex;
  gap:10px;
  margin:10px 0 12px;
  overflow-x:auto;
}
.tabbtn{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
  color:var(--text);
}
body[data-theme="dark"] .tabbtn{
  border-color: rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}
.tabbtn.active{
  background: linear-gradient(135deg, var(--samarkand), var(--gold));
  border:1px solid rgba(255,255,255,.20);
  color:#fff;
}
.small-note{ opacity:.75; font-size:12px; margin-top:6px; }

@media (hover:hover){
  .btn:hover{ box-shadow: 0 14px 30px rgba(0,0,0,.10); }
  .card:hover{ transform:translateY(-2px); box-shadow: 0 18px 46px rgba(0,0,0,.14); }
  .sticky-btn:hover{ box-shadow: 0 18px 44px rgba(31,74,168,.20); }
  .pop-card:hover{ transform:translateY(-2px); box-shadow: 0 18px 46px rgba(0,0,0,.14); }
  .menu-item:hover{ filter: brightness(1.02); }
}
</style>
</head>

<body data-theme="light">

<div class="header">
  <img src="logo.png" onerror="this.src='logo.png'">
  <div style="position:relative; z-index:6;">
    <div class="brand-title">O'ZBEGIM</div>
    <div class="brand-sub"></div>
    <div class="brand-phone">
      <a href="tel:+998992711925" onclick="callPhone(event)">+998 99 271 19 25</a>
    </div>
  </div>

  <!-- ‚úÖ –ë—É—Ä–≥–µ—Ä -->
  <div class="burger-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger-ic"><span></span><span></span><span></span></div>
  </div>

  <!-- üîç –ø–æ–∏—Å–∫ -->
  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥–∞..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="sendOrder()" id="stickyOrder">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<!-- ‚úÖ‚úÖ‚úÖ BACKDROP + MENU SHEET -->
<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>

<div class="menu-sheet" id="menuSheet" role="dialog" aria-modal="true">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b id="menuTitle">–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">

    <!-- –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ -->
    <div class="menu-item" onclick="toggleReviewWidget()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name" id="mReviewTitle">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub" id="mReviewSub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div class="review-wrap" id="reviewWidgetWrap">
      <div class="review-card">
        <iframe
          src="https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating"
          width="150"
          height="50"
          frameborder="0"
          style="border:0; display:block;"
        ></iframe>
      </div>
      <div class="small-note" id="mReviewHint">
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.
      </div>
      <div style="display:flex; justify-content:center; margin-top:8px;">
        <button class="tabbtn" id="mOpenReviewsBtn" onclick="openYandexReviews(event)">–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã</button>
      </div>
    </div>

    <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
    <a class="menu-item" href="tel:+998992711925" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name" id="mCallTitle">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 99 271 19 25</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <!-- Instagram -->
    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.3A5.7 5.7 0 1 1 6.3 14 5.7 5.7 0 0 1 12 8.3zm0 2A3.7 3.7 0 1 0 15.7 14 3.7 3.7 0 0 0 12 10.3zM18 6.7a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <div class="menu-txt">
          <div class="menu-name" id="mInstaTitle">@uzbegimosh</div>
          <div class="menu-sub" id="mInstaSub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <!-- –¢–µ–º–∞ -->
    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name" id="mThemeTitle">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right" id="mThemeAction">–°–º–µ–Ω–∏—Ç—å</div>
    </div>

    <!-- –û –Ω–∞—Å -->
    <div class="menu-item" onclick="openAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name" id="mAboutTitle">–û –Ω–∞—Å</div>
          <div class="menu-sub" id="mAboutSub">–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

  </div>
</div>

<!-- ‚úÖ ABOUT MODAL -->
<div class="about-modal" id="aboutModal" onclick="aboutBackdropClick(event)">
  <div class="about-card">
    <div class="about-head">
      <b id="aboutTitle">–û –Ω–∞—Å</b>
      <button class="menu-close" onclick="closeAbout()">√ó</button>
    </div>

    <div class="about-tabs">
      <button class="tabbtn active" id="tabRu" onclick="setAboutLang('ru')">üá∑üá∫ RU</button>
      <button class="tabbtn" id="tabUz" onclick="setAboutLang('uz')">üá∫üáø UZ</button>
      <button class="tabbtn" id="tabEn" onclick="setAboutLang('en')">üá¨üáß EN</button>
    </div>

    <div class="about-body" id="aboutBody"></div>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* ====== –î–ê–ù–ù–´–ï –î–õ–Ø –ë–£–†–ì–ï–†–ê ====== */
const PHONE_E164 = "+998992711925";
const PHONE_TEL  = "tel:+998992711925";
const IG_URL = "https://www.instagram.com/uzbegimosh/";
const YANDEX_WIDGET_URL = "https://yandex.ru/sprav/widget/rating-badge/23178318202?type=rating";

/* ‚úÖ —Ç–µ–∫—Å—Ç—ã –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é –Ω–∞ 3 —è–∑—ã–∫–∞ */
const MENU_I18N = {
  ru:{
    menu:'–ú–µ–Ω—é',
    review_title:'–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
    review_sub:'–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã',
    review_hint:'–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –Ω–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã¬ª.',
    open_reviews:'–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã',
    call:'–ü–æ–∑–≤–æ–Ω–∏—Ç—å',
    insta_sub:'–û—Ç–∫—Ä—ã—Ç—å Instagram',
    theme:'–¢–µ–º–∞',
    theme_light:'–°–≤–µ—Ç–ª–∞—è',
    theme_dark:'–¢—ë–º–Ω–∞—è',
    theme_action:'–°–º–µ–Ω–∏—Ç—å',
    about:'–û –Ω–∞—Å',
    about_sub:'–ê–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ',
    about_title:'–û –Ω–∞—Å'
  },
  uz:{
    menu:'Menyu',
    review_title:'Fikr qoldirish',
    review_sub:'Yandex reyting / fikrlar',
    review_hint:'Agar vidjet Telegramda ochilmasa ‚Äî ¬´Sharhlarni ochish¬ªni bosing.',
    open_reviews:"Sharhlarni ochish",
    call:"Qo'ng'iroq qilish",
    insta_sub:"Instagramni ochish",
    theme:"Mavzu",
    theme_light:"Yorug'",
    theme_dark:"Qorong'i",
    theme_action:"Almashtirish",
    about:"Biz haqimizda",
    about_sub:"Manzil va ma'lumot",
    about_title:"Biz haqimizda"
  },
  en:{
    menu:'Menu',
    review_title:'Leave a review',
    review_sub:'Yandex rating / reviews',
    review_hint:'If the widget doesn‚Äôt open in Telegram ‚Äî tap ‚ÄúOpen reviews‚Äù.',
    open_reviews:'Open reviews',
    call:'Call',
    insta_sub:'Open Instagram',
    theme:'Theme',
    theme_light:'Light',
    theme_dark:'Dark',
    theme_action:'Switch',
    about:'About us',
    about_sub:'Address and info',
    about_title:'About us'
  }
};

/* –û –ù–ê–° —Ç–µ–∫—Å—Ç—ã */
const ABOUT_TEXT = {
  ru:
`üá∑üá∫ –û –Ω–∞—Å

–ö–∞—Ñ–µ Uzbegim Osh ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –æ–∂–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è —É–∑–±–µ–∫—Å–∫–∞—è –∫—É—Ö–Ω—è.
–ú—ã –≥–æ—Ç–æ–≤–∏–º –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª—é–¥–∞ –ø–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º —Ä–µ—Ü–µ–ø—Ç–∞–º, —Å–æ—Ö—Ä–∞–Ω—è—è –≤–∫—É—Å, –∞—Ä–æ–º–∞—Ç –∏ –¥—É—à—É –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞.

–£—é—Ç–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, —Å–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫ –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–º —Ç—Ä–∞–¥–∏—Ü–∏—è–º –¥–µ–ª–∞—é—Ç –∫–∞–∂–¥—ã–π –≤–∏–∑–∏—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–º.
–ñ–¥—ë–º –≤–∞—Å –≤ —Å–∞–º–æ–º —Å–µ—Ä–¥—Ü–µ –°–∞–º–∞—Ä–∫–∞–Ω–¥–∞ ‚Äî
üìç –≥. –°–∞–º–∞—Ä–∫–∞–Ω–¥, —É–ª. –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω—Å–∫–∞—è, 74

Uzbegim Osh ‚Äî –≤–∫—É—Å, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –≤—Ä–µ–º–µ–Ω–µ–º üá∫üáøüçΩÔ∏è`,
  uz:
`üá∫üáø –ë–∏–∑ “≥–∞“õ–∏–º–∏–∑–¥–∞ (—É–∑–±–µ–∫—á–∞, –∫–∏—Ä–∏–ª–ª)

Uzbegim Osh –∫–∞—Ñ–µ—Å–∏ ‚Äî –±—É –µ—Ä–¥–∞ “≥–∞“õ–∏“õ–∏–π —û–∑–±–µ–∫ –º–∏–ª–ª–∏–π —Ç–∞–æ–º–ª–∞—Ä–∏ –∂–æ–Ω–ª–∞–Ω–∞–¥–∏.
–ë–∏–∑ –∞–Ω—ä–∞–Ω–∞–≤–∏–π —Ä–µ—Ü–µ–ø—Ç–ª–∞—Ä –∞—Å–æ—Å–∏–¥–∞ —Ç–∞–æ–º–ª–∞—Ä —Ç–∞–π—ë—Ä–ª–∞–π–º–∏–∑, –é–∑–±–µ–∫–∏—Å—Ç–æ–Ω–Ω–∏–Ω–≥ –º–∞–∑–∞—Å–∏, “≥–∏–¥–∏ –≤–∞ —Ä—É“≥–∏–Ω–∏ —Å–∞“õ–ª–∞–± “õ–æ–ª–∞–º–∏–∑.

“ö—É–ª–∞–π –º—É“≥–∏—Ç, —è–Ω–≥–∏ –º–∞“≥—Å—É–ª–æ—Ç–ª–∞—Ä –≤–∞ –º–∏–ª–ª–∏–π –æ—à–ø–∞–∑–ª–∏–∫ –∞–Ω—ä–∞–Ω–∞–ª–∞—Ä–≥–∞ “≥—É—Ä–º–∞—Ç “≥–∞—Ä –±–∏—Ä —Ç–∞—à—Ä–∏—Ñ–Ω–∏ —û–∑–∏–≥–∞ —Ö–æ—Å “õ–∏–ª–∞–¥–∏.
–°–∏–∑–Ω–∏ –°–∞–º–∞—Ä“õ–∞–Ω–¥–Ω–∏–Ω–≥ —é—Ä–∞–≥–∏–¥–∞ –∫—É—Ç–∞–º–∏–∑ ‚Äî
üìç –°–∞–º–∞—Ä“õ–∞–Ω–¥ —à–∞“≥—Ä–∏, –é–∑–±–µ–∫–∏—Å—Ç–æ–Ω –∫—û—á–∞—Å–∏, 74

Uzbegim Osh ‚Äî –≤–∞“õ—Ç —Å–∏–Ω–æ–≤–∏–¥–∞–Ω —û—Ç–≥–∞–Ω –º–∞–∑–∑–∞ üá∫üáøüçΩÔ∏è`,
  en:
`üá¨üáß About Us

Uzbegim Osh is a place where authentic Uzbek cuisine comes to life.
We prepare traditional national dishes using classic recipes, preserving the true taste, aroma, and spirit of Uzbekistan.

A cozy atmosphere, fresh ingredients, and respect for culinary traditions make every visit special.
We welcome you in the heart of Samarkand ‚Äî
üìç 74 Uzbekistanskaya Street, Samarkand

Uzbegim Osh ‚Äî a taste proven by time üá∫üáøüçΩÔ∏è`
};

/* –∑–≤–æ–Ω–æ–∫ –∏–∑ WebApp */
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(PHONE_TEL);
      return;
    }
  }catch(_){}
  window.location.href = PHONE_TEL;
}

/* ===== BURGER OPEN/CLOSE ===== */
function openTopMenu(){
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}

/* Review */
function toggleReviewWidget(){
  const w = document.getElementById('reviewWidgetWrap');
  w.style.display = (w.style.display === 'none' || !w.style.display) ? 'block' : 'none';
}
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(YANDEX_WIDGET_URL);
      return;
    }
  }catch(_){}
  window.open(YANDEX_WIDGET_URL, "_blank");
}

/* Instagram */
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(IG_URL);
      return;
    }
  }catch(_){}
  window.open(IG_URL, "_blank");
}

/* Theme */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('ozbegim_theme', theme);

  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? t.theme_dark : t.theme_light;

  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}

/* About modal */
function openAbout(){
  closeTopMenu();
  setAboutLang(currentAboutLang);
  document.getElementById('aboutModal').classList.add('show');
}
function closeAbout(){
  document.getElementById('aboutModal').classList.remove('show');
}
function aboutBackdropClick(e){
  if(e.target && e.target.id === 'aboutModal') closeAbout();
}

let currentAboutLang = 'ru';
function setAboutLang(l){
  currentAboutLang = l;
  document.getElementById('aboutBody').textContent = ABOUT_TEXT[l] || ABOUT_TEXT.ru;

  document.getElementById('tabRu').classList.toggle('active', l==='ru');
  document.getElementById('tabUz').classList.toggle('active', l==='uz');
  document.getElementById('tabEn').classList.toggle('active', l==='en');
}

/* ====== –¢–í–û–ô –ö–û–î –ú–ï–ù–Æ/–ö–û–†–ó–ò–ù–´ (–û–°–¢–ê–í–ò–õ) ====== */
const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

let lang='ru', category='salads', type='delivery', payment='cash';
let cart = {}; // cart[itemId] = qty

const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop',empty:'Savat bo‚Äòsh'},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular',empty:'Cart is empty'}
};

const CATS={
  ru:{salads:'ü•ó –°–∞–ª–∞—Ç—ã',sauce:'ü•£ –°–æ—É—Å',first:'üçú –ü–µ—Ä–≤—ã–µ –±–ª—é–¥–∞',hot:'üç≤ –ì–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞',garnish:'üçü –ì–∞—Ä–Ω–∏—Ä',drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏'},
  uz:{salads:'ü•ó Salatlar',sauce:'ü•£ Souslar',first:'üçú Birinchi taomlar',hot:'üç≤ Issiq taomlar',garnish:'üçü Garnir',drinks:'ü•§ Ichimliklar'},
  en:{salads:'ü•ó Salads',sauce:'ü•£ Sauces',first:'üçú First dishes',hot:'üç≤ Hot dishes',garnish:'üçü Side dishes',drinks:'ü•§ Drinks'}
};

const MENU = {
  salads:[
    {id:'vesenniy', p:25000, img:'images/vesenniy.png', n:{ru:'–í–µ—Å–µ–Ω–Ω–∏–π', uz:'Bahorgi salat', en:'Spring salad'}},
    {id:'osenniy', p:30000, img:'images/osenniy.png', n:{ru:'–û—Å–µ–Ω–Ω–∏–π', uz:'Kuzgi salat', en:'Autumn salad'}},
    {id:'grecheskiy', p:40000, img:'images/grecheskiy.png', n:{ru:'–ì—Ä–µ—á–µ—Å–∫–∏–π', uz:'Grecheskiy salat', en:'Greek salad'}},
    {id:'vecho', p:45000, img:'images/vecho.png', n:{ru:'–í–µ—á–æ', uz:'Vecho salat', en:'Vecho salad'}},
    {id:'krabovyy', p:40000, img:'images/krabovyy.png', n:{ru:'–ö—Ä–∞–±–æ–≤—ã–π', uz:'Krab salati', en:'Crab salad'}},
    {id:'elitnyy', p:45000, img:'images/elitnyy.png', n:{ru:'–≠–ª–∏—Ç–Ω—ã–π', uz:'Elit salat', en:'Premium salad'}},
    {id:'smak', p:40000, img:'images/smak.png', n:{ru:'–°–º–∞–∫', uz:'Smak salat', en:'Smak salad'}},
    {id:'rukolla', p:45000, img:'images/salat_s_rukolloy.png', n:{ru:'–°–∞–ª–∞—Ç —Å —Ä—É–∫–æ–ª–ª–æ–π', uz:'Rukola salati', en:'Arugula salad'}},
    {id:'vinegret', p:40000, img:'images/vinegret.png', n:{ru:'–í–∏–Ω–µ–≥—Ä–µ—Ç', uz:'Vinegret', en:'Vinaigrette'}},
    {id:'tsezar', p:45000, img:'images/tsezar_klassicheskiy.png', n:{ru:'–¶–µ–∑–∞—Ä—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', uz:'Sezar klassik', en:'Caesar classic'}},
    {id:'olivye', p:40000, img:'images/olive.png', n:{ru:'–û–ª–∏–≤—å–µ', uz:'Olivye', en:'Olivier'}},
    {id:'svezhiy', p:25000, img:'images/svezhiy.png', n:{ru:'–°–≤–µ–∂–∏–π', uz:'Yangi salat', en:'Fresh salad'}}
  ],
  sauce:[
    {id:'chalop', p:10000, img:'images/chalop.png', n:{ru:'–ß–∞–ª–æ–ø', uz:'Chalop', en:'Chalop'}},
    {id:'tomato_sauce', p:5000, img:'images/tomato_sauce.png', n:{ru:'–°–æ—É—Å –∏–∑ –ø–æ–º–∏–¥–æ—Ä–æ–≤', uz:'Pomidor sousi', en:'Tomato sauce'}}
  ],
  first:[
    {id:'shurpa', p:40000, img:'images/shurpa.png', n:{ru:'–®—É—Ä–ø–∞', uz:"Sho'rva", en:'Shurpa'}},
    {id:'pelmeni', p:40000, img:'images/pelmeni.png', n:{ru:'–ü–µ–ª—å–º–µ–Ω–∏', uz:'Chuchvara', en:'Dumplings'}},
    {id:'lagman', p:40000, img:'images/lagman.png', n:{ru:'–õ–∞–≥–º–∞–Ω', uz:"Lag'mon", en:'Lagman'}},
    {id:'bulon', p:20000, img:'images/bulon.png', n:{ru:'–°—É–ø –±—É–ª—å–æ–Ω', uz:"Bulyon sho'rva", en:'Broth soup'}}
  ],
  hot:[
    {id:'manty1', p:10000, img:'images/manty1.png', n:{ru:'–ú–∞–Ω—Ç—ã 1—à—Ç', uz:'Manti 1 dona', en:'Manti (1 pc)'}},
    {id:'plov05', p:50000, img:'images/plov05.png', n:{ru:'–ü–ª–æ–≤ 0.5', uz:'Osh 0.5', en:'Plov 0.5'}},
    {id:'halisa', p:80000, img:'images/halisa.png', n:{ru:'–•–∞–ª–∏—Å–∞', uz:'Halisa', en:'Halisa'}},
    {id:'kurutob', p:80000, img:'images/kurutob.png', n:{ru:'–ö—É—Ä—É—Ç–æ–±', uz:'Qurutob', en:'Qurutob'}},
    {id:'fried_lagman', p:50000, img:'images/fried_lagman.png', n:{ru:'–ñ–∞—Ä–µ–Ω–Ω—ã–π –õ–∞–≥–º–∞–Ω', uz:"Qovurilgan lag'mon", en:'Fried lagman'}}
  ],
  garnish:[
    {id:'fri', p:20000, img:'images/fri.png', n:{ru:'–§—Ä–∏', uz:'Fri', en:'French fries'}}
  ],
  drinks:[
    {id:'cola15', p:20000, img:'images/cola15.png', n:{ru:'Coca Cola 1.5L', uz:'Coca Cola 1.5L', en:'Coca Cola 1.5L'}},
    {id:'fanta15', p:20000, img:'images/fanta15.png', n:{ru:'Fanta 1.5L', uz:'Fanta 1.5L', en:'Fanta 1.5L'}},
    {id:'pepsi15', p:20000, img:'images/pepsi15.png', n:{ru:'Pepsi 1.5L', uz:'Pepsi 1.5L', en:'Pepsi 1.5L'}},
    {id:'juice1', p:20000, img:'images/juice1.png', n:{ru:'–°–æ–∫ –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ 1L', uz:'Sharbat (assort) 1L', en:'Juice assorted 1L'}},
    {id:'chertoq15', p:8000, img:'images/chertoq15.png', n:{ru:'–í–æ–¥–∞ –≥–∞–∑ / –±–µ–∑ –≥–∞–∑–∞ Chertoq 1.5L', uz:'Chertoq suv 1.5L (gazli / gazsiz)', en:'Chertoq water 1.5L (sparkling / still)'}},
    {id:'tea', p:5000, img:'images/tea.png', n:{ru:'–ß–∞–π –∑–µ–ª—ë–Ω—ã–π / —á—ë—Ä–Ω—ã–π', uz:'Choy (yashil / qora)', en:'Tea (green / black)'}},
    {id:'tea_lemon', p:15000, img:'images/tea_lemon.png', n:{ru:'–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º', uz:'Limonli choy', en:'Tea with lemon'}},
    {id:'coffee', p:10000, img:'images/coffee.png', n:{ru:'–ö–æ—Ñ–µ —Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π —á—ë—Ä–Ω—ã–π', uz:'Qora kofe (eritma)', en:'Instant black coffee'}}
  ]
};

const POPULAR_IDS = ['plov05','manty1','shurpa','tsezar'];

const ITEM_BY_ID = {};
for (const cat in MENU){
  for (const it of MENU[cat]) ITEM_BY_ID[it.id] = it;
}

function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(text, q){
  const safe = escapeHtml(text);
  if(!q) return safe;
  const lower = safe.toLowerCase();
  const idx = lower.indexOf(q.toLowerCase());
  if(idx === -1) return safe;
  const before = safe.slice(0, idx);
  const mid = safe.slice(idx, idx + q.length);
  const after = safe.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

function loadSaved(){
  const a = localStorage.getItem("ozbegim_address") || '';
  const p = localStorage.getItem("ozbegim_phone") || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem("ozbegim_address", address.value));
  phone.addEventListener('input', ()=>localStorage.setItem("ozbegim_phone", phone.value));
}

function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}

/* ‚úÖ‚úÖ‚úÖ –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥ –∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É UI, –∏ –∫ –±—É—Ä–≥–µ—Ä—É */
function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  stickyOrder.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  popularTitle.innerText = TEXT[lang].popular;

  renderPopular();
  renderCats();
  renderProducts();
  updateTotal();

  applyBurgerI18n();     // ‚úÖ –±—É—Ä–≥–µ—Ä –ø–µ—Ä–µ–≤–æ–¥
  syncThemeLabel();      // ‚úÖ –ø–æ–¥–ø–∏—Å—å —Ç–µ–º—ã –≤ –±—É—Ä–≥–µ—Ä
}

function applyBurgerI18n(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const el = (id)=>document.getElementById(id);

  if(el('menuTitle')) el('menuTitle').innerText = t.menu;
  if(el('mReviewTitle')) el('mReviewTitle').innerText = t.review_title;
  if(el('mReviewSub')) el('mReviewSub').innerText = t.review_sub;
  if(el('mReviewHint')) el('mReviewHint').innerText = t.review_hint;
  if(el('mOpenReviewsBtn')) el('mOpenReviewsBtn').innerText = t.open_reviews;

  if(el('mCallTitle')) el('mCallTitle').innerText = t.call;

  // insta name –æ—Å—Ç–∞–≤–ª—è–µ–º @uzbegimosh, –º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—å
  if(el('mInstaSub')) el('mInstaSub').innerText = t.insta_sub;

  if(el('mThemeTitle')) el('mThemeTitle').innerText = t.theme;
  if(el('mThemeAction')) el('mThemeAction').innerText = t.theme_action;

  if(el('mAboutTitle')) el('mAboutTitle').innerText = t.about;
  if(el('mAboutSub')) el('mAboutSub').innerText = t.about_sub;

  if(el('aboutTitle')) el('aboutTitle').innerText = t.about_title;
}

function syncThemeLabel(){
  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const cur = document.body.getAttribute('data-theme') || 'light';
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (cur === 'dark') ? t.theme_dark : t.theme_light;
}

function getName(it){
  return (it && it.n && it.n[lang]) ? it.n[lang] : (it?.n?.ru || it?.id || '');
}

function renderPopular(){
  popularRow.innerHTML = '';
  POPULAR_IDS.forEach(id=>{
    const it = ITEM_BY_ID[id];
    if(!it) return;
    cart[id] = cart[id] || 0;
    const name = getName(it);
    popularRow.innerHTML += `
      <div class="pop-card" onclick="addPopular('${id}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${it.img}" onerror="this.src='logo.png'"></div>
        <div class="pop-name">${escapeHtml(name)}</div>
        <div class="pop-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
      </div>
    `;
  });
}
function addPopular(id){
  chg(id, 1);
  if(isSearchOpen()) closeSearch();
}

function renderCats(){
  cats.innerHTML='';
  for(let k in MENU){
    cats.innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';renderCats();renderProducts()">${CATS[lang][k] || k}</button>`;
  }
  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 50);
}

function cardHTML(it, q=''){
  const name = getName(it);
  const nameHtml = highlight(name, q);
  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='logo.png'"></div>
    <div>${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${it.id}',-1)">‚àí</button>
      <span id="c_${it.id}">${cart[it.id]||0}</span>
      <button onclick="chg('${it.id}',1)">+</button>
    </div>
  </div>`;
}

function renderProducts(){
  products.innerHTML='';
  (MENU[category] || []).forEach(it=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML += cardHTML(it,'');
  });
}

function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
}

function price(id){
  return ITEM_BY_ID[id]?.p || 0;
}

function updateTotal(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  total.innerText = formatSum(s);
  stickyTotal.innerText = formatSum(s);
}

function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

/* Search */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }

function toggleSearch(){
  if(isSearchOpen()) closeSearch();
  else openSearch();
}
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  popularWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  popularWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }

function onSearchKey(e){
  if(e.key === 'Enter') closeSearch();
}

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';

  if(!q){
    renderProducts();
    return;
  }

  for(let c in MENU){
    MENU[c].forEach(it=>{
      const name = getName(it);
      // ‚úÖ –∏—â–µ–º –ø–æ —Ç–µ–∫—É—â–µ–º—É —è–∑—ã–∫—É + –ø–æ RU/UZ/EN
      const n_ru = (it.n?.ru||'').toLowerCase();
      const n_uz = (it.n?.uz||'').toLowerCase();
      const n_en = (it.n?.en||'').toLowerCase();
      const n_cur = String(name).toLowerCase();

      if(n_cur.includes(q) || n_ru.includes(q) || n_uz.includes(q) || n_en.includes(q)){
        cart[it.id]=cart[it.id]||0;
        products.innerHTML += cardHTML(it, q);
      }
    });
  }
}

document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn) closeSearch();
}, true);

/* order id */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `ozbegim_seq_${d.getFullYear()}${mm}${dd}`;

  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));

  const num = String(n).padStart(3,'0');
  return `OZB-${dd}${mm}-${num}`;
}

function calcTotalNum(){
  let s = 0;
  for (const id in cart) s += (Number(cart[id] || 0) * price(id));
  return s;
}

function buildOrderLines(){
  const lines = [];
  for(const id in cart){
    const qty = Number(cart[id]||0);
    if(qty<=0) continue;
    const it = ITEM_BY_ID[id];
    if(!it) continue;
    lines.push({
      id,
      name: getName(it),
      qty,
      price: it.p,
      sum: it.p * qty
    });
  }
  return lines;
}

/* send */
function sendOrder(){
  popup.classList.add('show');

  const cleanOrder = {};
  for (const id in cart) {
    const q = Number(cart[id] || 0);
    if (q > 0) cleanOrder[id] = q;
  }

  if (Object.keys(cleanOrder).length === 0) {
    popup.classList.remove('show');
    alert(TEXT[lang].empty);
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    lang,
    items: buildOrderLines(),
    order: cleanOrder,
    total: total.innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: address.value,
    phone: phone.value,
    comment: comment.value,
    order_id: genOrderId()
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

/* ===== theme init (–∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è / Telegram) ===== */
(function initTheme(){
  const saved = localStorage.getItem('ozbegim_theme');
  if(saved === 'dark' || saved === 'light'){
    applyTheme(saved);
  }else{
    const tgTheme = (window.Telegram && Telegram.WebApp && Telegram.WebApp.colorScheme) ? Telegram.WebApp.colorScheme : 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

/* ===== burger i18n helpers ===== */
function applyThemeAndSync(theme){
  applyTheme(theme);
  syncThemeLabel();
}

/* –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º applyTheme, –Ω–æ –Ω–µ –ª–æ–º–∞–µ–º —Ç–≤–æ–π –∫–æ–¥ */
const _origApplyTheme = applyTheme;
applyTheme = function(theme){
  _origApplyTheme(theme);
  syncThemeLabel();
};

/* ===== burger open/close ===== */
function openTopMenu(){
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}

/* ===== Review / Instagram use Telegram openLink if possible ===== */
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(YANDEX_WIDGET_URL);
      return;
    }
  }catch(_){}
  window.open(YANDEX_WIDGET_URL, "_blank");
}
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(IG_URL);
      return;
    }
  }catch(_){}
  window.open(IG_URL, "_blank");
}

/* ===== Theme toggle uses i18n labels ===== */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('ozbegim_theme', theme);

  const t = MENU_I18N[lang] || MENU_I18N.ru;
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? t.theme_dark : t.theme_light;

  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#fbf7ef');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}

/* About */
let currentAboutLang = 'ru';
function setAboutLang(l){
  currentAboutLang = l;
  document.getElementById('aboutBody').textContent = ABOUT_TEXT[l] || ABOUT_TEXT.ru;

  document.getElementById('tabRu').classList.toggle('active', l==='ru');
  document.getElementById('tabUz').classList.toggle('active', l==='uz');
  document.getElementById('tabEn').classList.toggle('active', l==='en');
}

loadSaved();
bindSave();
applyLang();
setAboutLang('ru');
</script>
</body>
</html>
